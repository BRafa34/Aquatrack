{% extends 'base.html' %}
{% block title %}Mis Pedidos - AquaTrack{% endblock %}
{% block content %}
<div class="page-header">
  <h1>ğŸšš Mis Pedidos</h1>
  <div style="display: flex; gap: 1rem;">
    <a class="btn" href="{{ url_for('drivers.driver_map') }}">ğŸ—ºï¸ Ver Mapa</a>
    <a class="btn btn-secondary" href="{{ url_for('main.dashboard') }}">ğŸ  Volver</a>
  </div>
  <hr>
</div>

<div class="table-container">
  {% if orders %}
  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Cliente</th>
        <th>DirecciÃ³n</th>
        <th>Fecha de Entrega</th>
        <th>Estado</th>
        <th>Monto</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for order in orders %}
      <tr>
        <td>{{ order.id }}</td>
        <td>{{ order.client.name if order.client else '-' }}</td>
        <td>{{ order.client.address if order.client else '-' }}</td>
        <td>{{ order.delivery_date.strftime('%d/%m/%Y') if order.delivery_date else '-' }}</td>
        <td>
          <span class="status-badge status-{{ order.status }}">
            {% if order.status == 'pending' %}Pendiente
            {% elif order.status == 'assigned' %}Asignado
            {% elif order.status == 'delivered' %}Entregado
            {% elif order.status == 'cancelled' %}Cancelado
            {% else %}{{ order.status }}
            {% endif %}
          </span>
        </td>
        <td>{{ "Bs. {:.2f}".format(order.total_amount) if order.total_amount else '-' }}</td>
        <td>
          {% if order.status != 'delivered' and order.status != 'cancelled' %}
          <form method="post" action="{{ url_for('drivers.mark_delivered', order_id=order.id) }}" style="display:inline" onsubmit="return confirm('Â¿Marcar este pedido como entregado?');">
            <button class="btn btn-success" type="submit">âœ… Entregado</button>
          </form>
          <a class="btn btn-warning" href="{{ url_for('drivers.report_error', order_id=order.id) }}">âš ï¸ Reportar Error</a>
          {% else %}
          <span style="color: #666; font-size: 0.9em;">
            {% if order.status == 'delivered' %}
              Entregado el {{ order.delivered_at.strftime('%d/%m/%Y %H:%M') if order.delivered_at else '-' }}
            {% elif order.status == 'cancelled' %}
              Cancelado
              {% if order.driver_notes %}
              <br><small>Nota: {{ order.driver_notes[:50] }}{% if order.driver_notes|length > 50 %}...{% endif %}</small>
              {% endif %}
            {% endif %}
          </span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div style="text-align: center; padding: 3rem; color: #666;">
    <p style="font-size: 1.2em;">No tienes pedidos asignados en este momento.</p>
  </div>
  {% endif %}
</div>
{% endblock %}

